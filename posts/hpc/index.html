<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="en">

    <meta name="author" content="Ravin Poudel">
    <meta name="description" content="Request resource for development environment
#!/bin/bash  module load ufrc module load slurm srundev --account=epi --qos=epi-b --time=02:00:00 Download files from online sequence repository- vendor
#!/bin/sh #SBATCH -p hpg1-compute #SBATCH --account=epi #SBATCH --qos=epi #SBATCH --job-name=fastspar #SBATCH --mail-type=ALL #SBATCH --mail-user=rp3448@ufl.edu #SBATCH --ntasks=1 #SBATCH --mem=2gb #SBATCH --time=72:00:00 date;hostname;pwd wget --user=ravin --password=????????? http://hwwgenotyping.ksu.edu/data/ravin/2017/FLB2017AM-GBS_001-3_job319/AAAA-FLB2017_1_1.fastq ## ??????? == password Basic job script
#!/bin/sh #SBATCH -p hpg1-compute #SBATCH --account=epi #SBATCH --qos=epi-b #SBATCH --job-name=mothur_NCBI #SBATCH --mail-type=ALL #SBATCH --mail-user=rp3448@ufl.edu #SBATCH --ntasks=1 #SBATCH --cpus-per-task=48 #SBATCH --mem=64gb #SBATCH --time=04:00:00 date;hostname;pwd # load the required programs module load mothur mothur GetFastQs_Ravin_bac2014.">
    <meta name="keywords" content="bioinformatics,genomics,personal">

    
      <script src="https://twemoji.maxcdn.com/v/latest/twemoji.min.js" crossorigin="anonymous"></script>
    

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Job Submission on HPCs"/>
<meta name="twitter:description" content="Request resource for development environment
#!/bin/bash  module load ufrc module load slurm srundev --account=epi --qos=epi-b --time=02:00:00 Download files from online sequence repository- vendor
#!/bin/sh #SBATCH -p hpg1-compute #SBATCH --account=epi #SBATCH --qos=epi #SBATCH --job-name=fastspar #SBATCH --mail-type=ALL #SBATCH --mail-user=rp3448@ufl.edu #SBATCH --ntasks=1 #SBATCH --mem=2gb #SBATCH --time=72:00:00 date;hostname;pwd wget --user=ravin --password=????????? http://hwwgenotyping.ksu.edu/data/ravin/2017/FLB2017AM-GBS_001-3_job319/AAAA-FLB2017_1_1.fastq ## ??????? == password Basic job script
#!/bin/sh #SBATCH -p hpg1-compute #SBATCH --account=epi #SBATCH --qos=epi-b #SBATCH --job-name=mothur_NCBI #SBATCH --mail-type=ALL #SBATCH --mail-user=rp3448@ufl.edu #SBATCH --ntasks=1 #SBATCH --cpus-per-task=48 #SBATCH --mem=64gb #SBATCH --time=04:00:00 date;hostname;pwd # load the required programs module load mothur mothur GetFastQs_Ravin_bac2014."/>

    <meta property="og:title" content="Job Submission on HPCs" />
<meta property="og:description" content="Request resource for development environment
#!/bin/bash  module load ufrc module load slurm srundev --account=epi --qos=epi-b --time=02:00:00 Download files from online sequence repository- vendor
#!/bin/sh #SBATCH -p hpg1-compute #SBATCH --account=epi #SBATCH --qos=epi #SBATCH --job-name=fastspar #SBATCH --mail-type=ALL #SBATCH --mail-user=rp3448@ufl.edu #SBATCH --ntasks=1 #SBATCH --mem=2gb #SBATCH --time=72:00:00 date;hostname;pwd wget --user=ravin --password=????????? http://hwwgenotyping.ksu.edu/data/ravin/2017/FLB2017AM-GBS_001-3_job319/AAAA-FLB2017_1_1.fastq ## ??????? == password Basic job script
#!/bin/sh #SBATCH -p hpg1-compute #SBATCH --account=epi #SBATCH --qos=epi-b #SBATCH --job-name=mothur_NCBI #SBATCH --mail-type=ALL #SBATCH --mail-user=rp3448@ufl.edu #SBATCH --ntasks=1 #SBATCH --cpus-per-task=48 #SBATCH --mem=64gb #SBATCH --time=04:00:00 date;hostname;pwd # load the required programs module load mothur mothur GetFastQs_Ravin_bac2014." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ravinpoudel.github.io/posts/hpc/" />
<meta property="article:published_time" content="2018-12-15T00:00:00+00:00" />
<meta property="article:modified_time" content="2018-12-15T00:00:00+00:00" />


    
      <base href="https://ravinpoudel.github.io/posts/hpc/">
    
    <title>
  Job Submission on HPCs · Ravin Poudel
</title>

    
      <link rel="canonical" href="https://ravinpoudel.github.io/posts/hpc/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css" integrity="sha384-Bfad6CLCknfcloXFOyFnlgtENryhrpZCe29RTifKEixXQZ38WheV+i/6YWSzkz3V" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="/css/coder.min.3219ef62ae52679b7a9c19043171c3cd9f523628c2a65f3ef247ee18836bc90b.css" integrity="sha256-MhnvYq5SZ5t6nBkEMXHDzZ9SNijCpl8&#43;8kfuGINryQs=" crossorigin="anonymous" media="screen" />
    

    

    
      
        
        
        <link rel="stylesheet" href="/css/coder-dark.min.e78e80fc3a585a4d1c8fc7f58623b6ff852411e38431a9cd1792877ecaa160f6.css" integrity="sha256-546A/DpYWk0cj8f1hiO2/4UkEeOEManNF5KHfsqhYPY=" crossorigin="anonymous" media="screen" />
      
    

    

    

    <link rel="icon" type="image/png" href="https://ravinpoudel.github.io/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://ravinpoudel.github.io/images/favicon-16x16.png" sizes="16x16">

    <meta name="generator" content="Hugo 0.72.0" />
  </head>

  
  
    
  
  <body class="colorscheme-auto"
        onload=" twemoji.parse(document.body); "
  >
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">
      Ravin Poudel
    </a>
    
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://ravinpoudel.github.io/about/">About</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://ravinpoudel.github.io/posts/">Blog</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://ravinpoudel.github.io/publications/">Publications</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://ravinpoudel.github.io/projects/">Projects</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://ravinpoudel.github.io/contact/">Contact</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://ravinpoudel.github.io/images/RavinPoudel.pdf">Resume</a>
          </li>
        
      
      
    </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">Job Submission on HPCs</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2018-12-15T00:00:00Z'>
                December 15, 2018
              </time>
            </span>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              3-minute read
            </span>
          </div>
          
          <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="/tags/python/">Python</a>
      <span class="separator">•</span>
    <a href="/tags/bioinformatics/">Bioinformatics</a>
      <span class="separator">•</span>
    <a href="/tags/biopython/">Biopython</a>
      <span class="separator">•</span>
    <a href="/tags/hpc/">HPC</a>
      <span class="separator">•</span>
    <a href="/tags/programming/">Programming</a>
      <span class="separator">•</span>
    <a href="/tags/bash/">Bash</a></div>

        </div>
      </header>

      <div>
        
        <p>Request resource for development environment</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span>
module load ufrc
module load slurm
srundev --account<span style="color:#f92672">=</span>epi --qos<span style="color:#f92672">=</span>epi-b --time<span style="color:#f92672">=</span>02:00:00

</code></pre></div><p>Download files from online sequence repository- vendor</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/bin/sh
</span><span style="color:#75715e"></span><span style="color:#75715e">#SBATCH -p hpg1-compute</span>
<span style="color:#75715e">#SBATCH --account=epi</span>
<span style="color:#75715e">#SBATCH --qos=epi</span>
<span style="color:#75715e">#SBATCH --job-name=fastspar</span>
<span style="color:#75715e">#SBATCH --mail-type=ALL</span>
<span style="color:#75715e">#SBATCH --mail-user=rp3448@ufl.edu</span>
<span style="color:#75715e">#SBATCH --ntasks=1</span> 
<span style="color:#75715e">#SBATCH --mem=2gb</span>
<span style="color:#75715e">#SBATCH --time=72:00:00</span>
date;hostname;pwd

wget --user<span style="color:#f92672">=</span>ravin --password<span style="color:#f92672">=</span>????????? http://hwwgenotyping.ksu.edu/data/ravin/2017/FLB2017AM-GBS_001-3_job319/AAAA-FLB2017_1_1.fastq

<span style="color:#75715e">## ??????? == password</span>

</code></pre></div><p>Basic job script</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/bin/sh
</span><span style="color:#75715e"></span><span style="color:#75715e">#SBATCH -p hpg1-compute</span>
<span style="color:#75715e">#SBATCH --account=epi</span>
<span style="color:#75715e">#SBATCH --qos=epi-b</span>
<span style="color:#75715e">#SBATCH --job-name=mothur_NCBI</span>
<span style="color:#75715e">#SBATCH --mail-type=ALL</span>
<span style="color:#75715e">#SBATCH --mail-user=rp3448@ufl.edu</span>
<span style="color:#75715e">#SBATCH --ntasks=1</span>
<span style="color:#75715e">#SBATCH --cpus-per-task=48</span> 
<span style="color:#75715e">#SBATCH --mem=64gb</span>
<span style="color:#75715e">#SBATCH --time=04:00:00</span>
date;hostname;pwd

<span style="color:#75715e"># load the required programs</span>
module load mothur

mothur  GetFastQs_Ravin_bac2014.txt
</code></pre></div><p>Example of Array job - Running SparCC</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/bin/sh
</span><span style="color:#75715e"></span><span style="color:#75715e">#SBATCH -p hpg1-compute</span>
<span style="color:#75715e">#SBATCH --account=epi</span>
<span style="color:#75715e">#SBATCH --qos=epi-b</span>
<span style="color:#75715e">#SBATCH --job-name=SparCC</span>
<span style="color:#75715e">#SBATCH --mail-type=ALL</span>
<span style="color:#75715e">#SBATCH --mail-user=rp3448@ufl.edu</span>
<span style="color:#75715e">#SBATCH --ntasks=1</span>
<span style="color:#75715e">#SBATCH --cpus-per-task=16</span> 
<span style="color:#75715e">#SBATCH --mem=8gb</span>
<span style="color:#75715e">#SBATCH --time=48:00:00</span>
<span style="color:#75715e">#SBATCH --output=logs/SparCC_%A_%a.log</span>
<span style="color:#75715e">#SBATCH --array=0-99</span>
date;hostname;pwd

<span style="color:#75715e"># load the required programs</span>
module load slurm
module load ufrc
module load fastspar
module load parallel
module load sparcc

SparCC.py data/permutation_<span style="color:#e6db74">${</span>SLURM_ARRAY_TASK_ID<span style="color:#e6db74">}</span>.txt -i <span style="color:#ae81ff">20</span> --cor_file<span style="color:#f92672">=</span>data/cor_permutation_<span style="color:#e6db74">${</span>SLURM_ARRAY_TASK_ID<span style="color:#e6db74">}</span>.txt
</code></pre></div><h4 id="task">Task</h4>
<p>Create a file with list of all the jobs, hear <code>GetFastQs_Ravin_bac2015.txt</code> has list of steps for each barcode. For 200 barcode we want to run some bioinformatics step. One can let the job run one at a time, which takes a lot of time. Best thing will be to use multiple computers - 200 computers for 200 barcode, then run the job simultaneously. If for one barcode it takes about 15 minutes to complete the job, then for 200 barcode it will still take the same 15 minutes. If ran one by one then it will take 15 x 200 minutes.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#  mothur_execute_preprocess_bac2014.sh</span>
<span style="color:#75715e">#!/bin/sh</span>
<span style="color:#75715e">#SBATCH -p hpg1-compute</span>
<span style="color:#75715e">#SBATCH --account=epi</span>
<span style="color:#75715e">#SBATCH --qos=epi-b</span>
<span style="color:#75715e">#SBATCH --job-name=mothur_NCBI</span>
<span style="color:#75715e">#SBATCH --mail-type=ALL</span>
<span style="color:#75715e">#SBATCH --mail-user=rp3448@ufl.edu</span>
<span style="color:#75715e">#SBATCH --ntasks=1</span>
<span style="color:#75715e">#SBATCH --cpus-per-task=48</span> 
<span style="color:#75715e">#SBATCH --mem=64gb</span>
<span style="color:#75715e">#SBATCH --time=04:00:00</span>
date;hostname;pwd

<span style="color:#75715e"># load the required programs</span>
module load mothur

mothur mothur_preprocess_bac2014.txt

grep groups GetFastQs_Ravin_Bac2014.txt  | awk <span style="color:#e6db74">&#39;{print $3}&#39;</span> | sed <span style="color:#e6db74">&#39;s/groups=//&#39;</span> | sed <span style="color:#e6db74">&#39;s:);::&#39;</span> &gt; groups.txt

</code></pre></div><p>What is <code>mothur_preprocess_bac2014.txt</code> ?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">make.contigs(ffastq=Tomato15BacEndo_R1.fastq, rfastq=Tomato15BacEndo_R2.fastq,processors=48);
summary.seqs(fasta=Tomato15BacEndo_R1.trim.contigs.fasta, processors=48);
trim.seqs(fasta=Tomato15BacEndo_R1.trim.contigs.fasta,oligos=Tomato15BacEndoOligos.txt, pdiffs=1, bdiffs=1, flip=T, processors=48);
summary.seqs(fasta=Tomato15BacEndo_R1.trim.contigs.trim.fasta, processors=48);
</code></pre></div><p>What is <code>GetFastQs_Ravin_Bac2014.txt</code> ?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">get.groups<span style="color:#f92672">(</span>group<span style="color:#f92672">=</span>Tomato15Bac_R1.trim.contigs.groups, fasta<span style="color:#f92672">=</span>Tomato15Bac_R1.trim.contigs.trim.fasta, groups<span style="color:#f92672">=</span>CH.15.Endo.M.1<span style="color:#f92672">)</span>;
list.seqs<span style="color:#f92672">(</span>fasta<span style="color:#f92672">=</span>Tomato15Bac_R1.trim.contigs.trim.pick.fasta<span style="color:#f92672">)</span>;
get.seqs<span style="color:#f92672">(</span>fastq<span style="color:#f92672">=</span>Tomato15Bac_R1.fastq, accnos<span style="color:#f92672">=</span>Tomato15Bac_R1.trim.contigs.trim.pick.accnos<span style="color:#f92672">)</span>;
system<span style="color:#f92672">(</span>cp Tomato15Bac_R1.pick.fastq CH.15.Endo.M.1_R1_001.fastq<span style="color:#f92672">)</span>;
get.seqs<span style="color:#f92672">(</span>fastq<span style="color:#f92672">=</span>Tomato15Bac_R2.fastq, accnos<span style="color:#f92672">=</span>Tomato15Bac_R1.trim.contigs.trim.pick.accnos<span style="color:#f92672">)</span>;
system<span style="color:#f92672">(</span>cp Tomato15Bac_R2.pick.fastq CH.15.Endo.M.1_R2_001.fastq<span style="color:#f92672">)</span>;
.
.
.
.
.
<span style="color:#75715e"># repeats for each barcode</span>

Array Job where input fasta file is same <span style="color:#66d9ef">for</span> all, but has different metafile.


<span style="color:#75715e">#SBATCH -p hpg1-compute</span>
<span style="color:#75715e">#SBATCH --account=epi</span>
<span style="color:#75715e">#SBATCH --qos=epi-b</span>
<span style="color:#75715e">#SBATCH --mail-type=END,FAIL</span>
<span style="color:#75715e">#SBATCH --mail-user=rp3448@ufl.edu</span>
<span style="color:#75715e">#SBATCH --output=mothur_logs/mothur_%A-%a.log</span>
<span style="color:#75715e">#SBATCH --ntasks=1</span>
<span style="color:#75715e">#SBATCH --mem=2gb</span>
<span style="color:#75715e">#SBATCH --time=2:00:00</span>
<span style="color:#75715e">#SBATCH --array=1-200</span>
date;hostname;pwd

<span style="color:#75715e"># load the required programs</span>
module load mothur

RUN<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>SLURM_ARRAY_TASK_ID<span style="color:#e6db74">}</span>
echo <span style="color:#e6db74">&#34;RUN: &#39;</span><span style="color:#e6db74">${</span>RUN<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;&#34;</span>
group<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>sed -n <span style="color:#e6db74">${</span>RUN<span style="color:#e6db74">}</span>p groups.txt<span style="color:#66d9ef">)</span>  <span style="color:#75715e">### here groups.txt has a list of filenames.- see above for how groups.txt was created.</span>
echo <span style="color:#e6db74">&#34;Processing group &#39;</span><span style="color:#e6db74">${</span>group<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;&#34;</span>
rm -rf <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>group<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>                        
mkdir -p <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>group<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
cd <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>group<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>

ln -s ../Tomato14BacEndo_R1.fastq .
ln -s ../Tomato14BacEndo_R2.fastq .
ln -s ../Tomato14BacEndo_R1.trim.contigs.trim.fasta .
ln -s  ../Tomato14BacEndo_R1.trim.contigs.groups .

cp ../mothur_group_endo.txt . 

sed -i <span style="color:#e6db74">&#34;s:MOTHUR_GROUP:</span><span style="color:#e6db74">${</span>group<span style="color:#e6db74">}</span><span style="color:#e6db74">:g&#34;</span> mothur_group_endo.txt

mothur mothur_group_endo.txt

cp <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>group<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>*.fastq ../demultiplex_fastq/

date

cd ..

rm -rf <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>group<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>

</code></pre></div>
      </div>


      <footer>
        


        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "https-ravinpoudel-github-io" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        
        
      </footer>
    </article>

    
  </section>

      </div>

      
  <footer class="footer">
    <section class="container">
      
      
        ©
        
          2000 -
        
        2020
         Ravin Poudel 
      
      
         · 
        Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.
      
      
    </section>
  </footer>

    </main>

    

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-99029062-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


    

  </body>

</html>
